const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BranchList-XIiqU_7L.js","./vendor-D1edepek.js","./button-DrlrjpMV.js","./App-WfN5djmF.js","./index-Dn0d7mUv.js","./index-Dl7VAv1T.css","./BranchIcon-DBBp-a1m.js","./alert-dialog-Dm4LHq-P.js","./BranchSearch-ClXPNcmW.js","./GitOutput-8TrXpqdx.js","./BranchCleanupButton-Br5SeHON.js","./UpdateAllBranchesButton-QQGWhYJ7.js"])))=>i.map(i=>d[i]);
import{r as n,j as s,n as k,G as J,o as I,I as Y,p as M,J as d}from"./vendor-D1edepek.js";import{_ as x}from"./index-Dn0d7mUv.js";import{c as T,u as A}from"./App-WfN5djmF.js";const D=n.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...u},h)=>s.jsx(k,{ref:h,decorative:r,orientation:t,className:T("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...u}));D.displayName=k.displayName;const q=({className:e})=>{const{config:t}=A();return s.jsxs("div",{className:T("flex flex-col items-center justify-center py-4",e),children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(J,{className:"h-6 w-6 text-primary"}),s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Branches Manager"})]}),s.jsx("h3",{className:"text text-gray-500",children:"scriptcase repository"}),t.headerLink&&s.jsx("a",{href:t.headerLink,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 hover:text-blue-700 hover:underline mt-1",children:t.headerLink})]})},F=n.forwardRef(({className:e,value:t,...r},u)=>s.jsx(I,{ref:u,className:T("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...r,children:s.jsx(Y,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));F.displayName=I.displayName;const Q=({isLoading:e,className:t})=>{const[r,u]=M.useState(0);return M.useEffect(()=>{if(e){u(0);const h=setTimeout(()=>{u(90)},100);return()=>clearTimeout(h)}else u(100)},[e]),!e&&r===0?null:s.jsx("div",{className:T("fixed top-0 left-0 right-0 z-50 transition-opacity duration-200",!e&&r===100?"opacity-0":"opacity-100",t),children:s.jsx(F,{value:r,className:"h-0.5 rounded-none bg-transparent"})})},W=()=>{const e=new Date().getFullYear();return s.jsxs("footer",{className:"py-4 px-6 text-sm text-gray-600 text-center",children:[s.jsxs("div",{children:["Copyright © ",e," Scriptcase"]}),s.jsx("div",{children:"All rights reserved to QA Scriptcase"})]})},g=async(e,t="",r)=>{try{const h=`${t?t.replace(/\/$/,""):""}/${e}`,m=await fetch(h,{...r,headers:{"Content-Type":"application/json",...(r==null?void 0:r.headers)||{}}});if(!m.ok){const l=await m.json().catch(()=>({}));throw new Error(l.message||`API error: ${m.status}`)}return m.json()}catch(u){throw u}},X=async(e=0,t=10,r="")=>await g(`branches?page=${e}&limit=${t}`,r),K=async(e=0,t=10,r="")=>await g(`remote-branches?page=${e}&limit=${t}`,r),Z=async(e,t="")=>{const r=await g("checkout",t,{method:"POST",body:JSON.stringify({branch:e})});return!r.success&&r.stderr?r.stderr:r.stdout||r.message||""},ee=async(e,t="")=>{const r=await g("delete-branch",t,{method:"POST",body:JSON.stringify({branch:e})});return!r.success&&r.stderr?r.stderr:r.stdout||r.message||""},ae=async(e="")=>{const t=await g("pull",e,{method:"POST"});return!t.success&&t.stderr?t.stderr:t.stdout||t.message||""},te=async(e="")=>await g("update-all-branches",e,{method:"POST"}),se=async(e="")=>{const t=await g("cleanup",e,{method:"POST"});return!t.success&&t.stderr?t.stderr:t.message||t.stdout||""},re=async(e,t=0,r=10,u="")=>await g(`remote-branches/search?q=${encodeURIComponent(e)}&page=${t}&limit=${r}`,u),ne=()=>{const{config:e}=A(),[t,r]=n.useState([]),[u,h]=n.useState([]),[m,l]=n.useState(""),[B,i]=n.useState(!1),[y,w]=n.useState(0),[b,j]=n.useState(0),[S,L]=n.useState(!0),[v,_]=n.useState(!0),[N,U]=n.useState(0),[E,$]=n.useState(0),[R,z]=n.useState(0),[G,C]=n.useState(!1),f=n.useCallback(async(a=!0)=>{try{i(!0);const c=a?0:y,o=await X(c,10,e.apiBaseUrl);return r(a?o.branches:p=>[...p,...o.branches]),w(c+1),L(o.pagination.hasMore),U(o.pagination.total),i(!1),o}catch{return d.error("Failed to load local branches"),i(!1),null}},[y,e.apiBaseUrl]),H=async()=>{B||!S||await f(!1)},V=()=>{z(a=>a+1),f(!0)},P=n.useCallback(async(a=!0)=>{try{const c=a?0:b,o=await K(c,10,e.apiBaseUrl);return h(a?o.branches:p=>[...p,...o.branches]),j(c+1),_(o.pagination.hasMore),$(o.pagination.total),o}catch{return d.error("Failed to load remote branches"),null}},[b,e.apiBaseUrl]);return{localBranches:t,remoteBranches:u,gitOutput:m,isLoading:B,isUpdatingAllBranches:G,fetchLocalBranches:f,fetchMoreLocalBranches:H,fetchRemoteBranches:P,fetchMoreRemoteBranches:async()=>{B||!v||await P(!1)},handleSwitchBranch:async(a,c)=>{i(!0),l("");try{const o=t.map(O=>({...O,isCurrent:O.name===a}));r(o);const p=await Z(a,e.apiBaseUrl);l(p),i(!1),c&&c.imported?d.success(`Local branch created: ${a}`,{description:"Branch imported from remote successfully."}):d.success(`Switched to branch: ${a}`,{description:"Branch change was successful."}),setTimeout(()=>{f(!0)},100)}catch(o){i(!1),o instanceof Error&&l(o.message),d.error(`Failed to switch to ${a}`),f(!0)}},handleDeleteBranch:async a=>{i(!0),l("");try{r(o=>o.filter(p=>p.name!==a));const c=await ee(a,e.apiBaseUrl);l(c),i(!1),d.success(`Deleted ${a}`),setTimeout(()=>{f(!0)},100)}catch(c){i(!1),c instanceof Error&&l(c.message),d.error(`Failed to delete ${a}`),f(!0)}},handleUpdateCurrentBranch:async()=>{i(!0),l("");try{const a=await ae(e.apiBaseUrl);l(a),i(!1),!a.includes("error:")&&!a.includes("fatal:")?d.success("Branch updated successfully",{description:"The current branch has been updated."}):d.error("Failed to update branch",{description:"See output panel for details."}),f(!0)}catch(a){i(!1),a instanceof Error&&l(a.message),d.error("Failed to update branch",{description:"See output panel for details."}),f(!0)}},handleUpdateAllBranches:async()=>{C(!0),l("");try{const a=await te(e.apiBaseUrl);let c=`Updating all branches:

`,o=0;a.results.forEach(p=>{p.success?(o++,c+=`✅ ${p.branch}: ${p.output.trim()}

`):c+=`❌ ${p.branch}: ${p.output.trim()}

`}),c+=`
Summary: ${o} of ${a.results.length} branches updated successfully.`,l(c),C(!1),a.overallSuccess?d.success("All branches updated",{description:`${o} of ${a.results.length} branches updated successfully.`}):d.warning("Some branches failed to update",{description:`${o} of ${a.results.length} branches updated successfully.`}),f(!0)}catch(a){C(!1),a instanceof Error&&l(a.message),d.error("Failed to update branches"),f(!0)}},handleCleanupBranches:async()=>{i(!0),l("");try{const a=await se(e.apiBaseUrl);l(a),i(!1),!a.includes("error:")&&!a.includes("fatal:")?d.success("Deprecated branches removed"):d.error("Failed to clean up branches",{description:"See output panel for details."}),setTimeout(()=>{f(!0)},100)}catch(a){i(!1),a instanceof Error&&l(a.message),d.error("Failed to clean up branches",{description:"See output panel for details."})}},handleSearch:async a=>{try{if(a.trim()===""){P(!0);return}const c=await re(a,0,20,e.apiBaseUrl);h(c.branches),_(c.pagination.hasMore),$(c.pagination.total),j(1)}catch{}},localBranchesHasMore:S,remoteBranchesHasMore:v,localBranchesTotal:N,remoteBranchesTotal:E,triggerReloadLocalBranches:V,reloadTrigger:R}},ce=n.lazy(()=>x(()=>import("./BranchList-XIiqU_7L.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url)),oe=n.lazy(()=>x(()=>import("./BranchSearch-ClXPNcmW.js"),__vite__mapDeps([8,1,6,3,4,5,7,2]),import.meta.url)),le=n.lazy(()=>x(()=>import("./GitOutput-8TrXpqdx.js"),__vite__mapDeps([9,1,3,4,5,2]),import.meta.url)),ie=n.lazy(()=>x(()=>import("./BranchCleanupButton-Br5SeHON.js"),__vite__mapDeps([10,1,2,3,4,5,7]),import.meta.url)),ue=n.lazy(()=>x(()=>import("./UpdateAllBranchesButton-QQGWhYJ7.js"),__vite__mapDeps([11,1,2,3,4,5,7]),import.meta.url)),de=()=>{const{config:e}=A(),{localBranches:t,remoteBranches:r,gitOutput:u,isLoading:h,isUpdatingAllBranches:m,fetchLocalBranches:l,fetchMoreLocalBranches:B,fetchRemoteBranches:i,fetchMoreRemoteBranches:y,handleSwitchBranch:w,handleDeleteBranch:b,handleUpdateCurrentBranch:j,handleUpdateAllBranches:S,handleCleanupBranches:L,handleSearch:v,localBranchesHasMore:_}=ne(),[N,U]=n.useState(!1),E=t.length>0||h;n.useEffect(()=>{if(e.isLoaded){const R=setTimeout(()=>{l(),i()},100);return()=>clearTimeout(R)}},[e.isLoaded]);const $=async()=>{U(!0);try{await j()}finally{U(!1)}};return s.jsxs(s.Fragment,{children:[s.jsx(Q,{isLoading:h||m}),s.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-8xl h-screen flex flex-col overflow-hidden",children:[s.jsx(q,{}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-6 flex-1 overflow-hidden mt-6",children:[s.jsxs("div",{className:"lg:col-span-4 flex flex-col overflow-hidden",children:[s.jsx(n.Suspense,{fallback:s.jsx("div",{className:"h-20 bg-gray-100 animate-pulse rounded"}),children:s.jsx(oe,{remoteBranches:r,localBranches:t,onSearch:v,onSelectRemoteBranch:w,onScrollEnd:y})}),s.jsx(D,{className:"my-4"}),s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold whitespace-nowrap mr-4",children:"Local Branches"}),E&&s.jsxs("div",{className:"flex items-center",children:[s.jsx(n.Suspense,{fallback:s.jsx("div",{className:"w-16 h-8 bg-gray-100 animate-pulse rounded"}),children:s.jsx(ie,{onCleanup:L,isLoading:h,isUpdatingAllBranches:m})}),s.jsx(n.Suspense,{fallback:s.jsx("div",{className:"w-16 h-8 ml-2 bg-gray-100 animate-pulse rounded"}),children:s.jsx(ue,{onUpdateAllBranches:S,isUpdating:m})})]})]}),s.jsx(n.Suspense,{fallback:s.jsx("div",{className:"flex-1 bg-gray-100 animate-pulse rounded"}),children:s.jsx(ce,{branches:t,onSwitchBranch:w,onDeleteBranch:b,onUpdateCurrentBranch:$,isLoading:h,isUpdatingCurrentBranch:N,isUpdatingAllBranches:m,onScrollEnd:B,hasMore:_,className:"flex-1 overflow-hidden"})})]}),s.jsx("div",{className:"lg:col-span-2 overflow-hidden flex flex-col h-full",children:s.jsx(n.Suspense,{fallback:s.jsx("div",{className:"h-full bg-gray-100 animate-pulse rounded"}),children:s.jsx(le,{output:u})})})]}),s.jsx(W,{})]})]})},je=()=>s.jsx(de,{});export{je as default};
